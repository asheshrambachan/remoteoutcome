% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rsv_estimator.R
\name{rsv_estimate}
\alias{rsv_estimate}
\title{RSV Treatment Effect Estimator}
\usage{
rsv_estimate(
  Y = NULL,
  D = NULL,
  S = NULL,
  R = NULL,
  pred_Y = NULL,
  pred_D = NULL,
  pred_S_e = NULL,
  pred_S_o = NULL,
  method = c("split", "crossfit", "none"),
  nfolds = 5,
  split_ratio = 0.5,
  ml_params = list(),
  se = TRUE,
  clusters = NULL,
  B = 1000,
  alpha = 0.05,
  eps = 1e-06,
  seed = NULL
)
}
\arguments{
\item{Y}{Outcome variable (binary, NA where not observed). Required if
predictions are not provided.}

\item{D}{Treatment indicator (binary, NA where not observed). Required if
predictions are not provided.}

\item{S}{Sample indicator. Can be:
\describe{
  \item{"e"}{Experimental sample only (observe D, R)}
  \item{"o"}{Observational sample only (observe Y, R)}
  \item{"both"}{Both samples (observe Y, D, R)}
}}

\item{R}{Remotely sensed variable. Required if predictions are not provided.}

\item{pred_Y}{(Optional) Predicted E[Y | R, S_o = 1]. If provided, other
predictions must also be provided.}

\item{pred_D}{(Optional) Predicted E[D | R, S_e = 1].}

\item{pred_S_e}{(Optional) Predicted P(S_e = 1 | R).}

\item{pred_S_o}{(Optional) Predicted P(S_o = 1 | R).}

\item{method}{Prediction fitting method. Options:
\describe{
  \item{"split"}{Simple sample split (default)}
  \item{"crossfit"}{K-fold cross-fitting}
  \item{"none"}{No sample splitting (use all data for training and testing)}
}}

\item{nfolds}{Number of folds for cross-fitting. Default is 5. Only used if
\code{method = "crossfit"}.}

\item{split_ratio}{Proportion of data to use for training in sample split.
Default is 0.5. Only used if \code{method = "split"}.}

\item{ml_params}{List of parameters for random forest. Supported parameters:
\describe{
  \item{ntree}{Number of trees. Default is 500.}
  \item{classwt_Y}{Class weights for outcome model. Default is c(10, 1).}
}
Additional parameters will be passed to \code{randomForest::randomForest}.}

\item{se}{Logical. Compute standard errors via bootstrap? Default is TRUE.}

\item{clusters}{Cluster identifiers for clustered bootstrap. If NULL,
individual-level bootstrap is used.}

\item{B}{Number of bootstrap replications. Default is 1000.}

\item{alpha}{Significance level for confidence interval. Default is 0.05
for 95% CI. Use 0.10 for 90% CI, 0.01 for 99% CI, etc.}

\item{eps}{Small constant for numerical stability. Default is 1e-6.}

\item{seed}{Random seed for reproducibility in sample splitting/cross-fitting.}
}
\value{
An object of class "rsv" containing:
  \describe{
    \item{coef}{Treatment effect estimate}
    \item{se}{Standard error (if \code{se = TRUE})}
    \item{ci_lower}{Lower bound of confidence interval (if \code{se = TRUE})}
    \item{ci_upper}{Upper bound of confidence interval (if \code{se = TRUE})}
    \item{alpha}{Significance level used for CI (if \code{se = TRUE})}
    \item{n_obs}{Sample size in observational sample}
    \item{n_exp}{Sample size in experimental sample}
    \item{n_both}{Sample size in both samples}
    \item{method}{Prediction fitting method used}
    \item{call}{The matched call}
  }
}
\description{
Estimates treatment effects using remotely sensed variables (RSVs) following
Rambachan, Singh, and Viviano (2025). Implements Algorithm 1 from the main
text for binary outcomes without pretreatment covariates.
}
\details{
The function supports two interfaces:
\enumerate{
  \item Provide fitted predictions \code{pred_Y}, \code{pred_D}, \code{pred_S_e},
        \code{pred_S_o} directly
  \item Provide raw data \code{(Y, D, S, R)} and the function fits predictions
        using random forests
}

The function also supports sample splitting and K-fold cross-fitting for
prediction fitting.
}
\examples{
\dontrun{
# Example 1: User provides raw data with sample splitting
result <- rsv_estimate(Y = Y, D = D, S = S, R = R,
                       method = "split", se = TRUE)

# Example 2: User provides raw data with cross-fitting
result <- rsv_estimate(Y = Y, D = D, S = S, R = R,
                       method = "crossfit", nfolds = 5, se = TRUE)

# Example 3: User provides raw data with custom ML parameters
result <- rsv_estimate(Y = Y, D = D, S = S, R = R,
                       method = "crossfit",
                       ml_params = list(ntree = 1000, classwt_Y = c(5, 1)),
                       se = TRUE)

# Example 4: User provides fitted predictions
result <- rsv_estimate(Y = Y, D = D, S = S,
                       pred_Y = pred_Y, pred_D = pred_D,
                       pred_S_e = pred_S_e, pred_S_o = pred_S_o,
                       se = TRUE)
}
}
